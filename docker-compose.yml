services:
  rabbitmq:
    image: rabbitmq:3-management
    ports: ["5672:5672","15672:15672"]

  marketfeed:
    build:
      context: .
      dockerfile: src/StockSim.MarketFeed/Dockerfile
    environment:
      ASPNETCORE_URLS: http://0.0.0.0:8080
    ports: ["8081:8080"]

  web:
    build:
      context: .
      dockerfile: src/StockSim.Web/Dockerfile
    environment:
      ASPNETCORE_URLS: http://0.0.0.0:8080
      ASPNETCORE_ENVIRONMENT: Development
      # Rabbit
      Rabbit__Host: rabbitmq
      Rabbit__Port: 5672
      Rabbit__User: guest
      Rabbit__Pass: guest
      Rabbit__Queue: stocksim.orders
      # MarketFeed base URL for the browser
      MarketFeed__BaseUrl: http://marketfeed:8080
      # SQLite DB path inside container
      ConnectionStrings__DefaultConnection: Data Source=/data/StockSim.db
    ports: ["8080:8080"]
    depends_on: [rabbitmq, marketfeed]
    volumes:
      - webdata:/data

volumes:
  webdata: {}
